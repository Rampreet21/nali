<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sessional Marks - Teacher Portal</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
    <style>
        /* Add your CSS styles here */
        body {
            font-family: 'Poppins', sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f5f7fa;
        }
        
        .app-container {
            display: flex;
            min-height: 100vh;
        }
        
        .sidebar {
            width: 250px;
            background-color: #2c3e50;
            color: white;
            padding: 20px 0;
        }
        
        .sidebar-header {
            padding: 0 20px 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .sidebar-menu {
            padding: 20px 0;
        }
        
        .menu-item {
            display: block;
            padding: 12px 20px;
            color: white;
            text-decoration: none;
            transition: all 0.3s;
        }
        
        .menu-item:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }
        
        .menu-item.active {
            background-color: #3498db;
        }
        
        .menu-item i {
            margin-right: 10px;
        }
        
        .main-content {
            flex: 1;
            padding: 20px;
            background-color: #f5f7fa;
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .header-title h1 {
            margin: 0;
            font-size: 24px;
            color: #2c3e50;
        }
        
        .user-profile {
            position: relative;
            cursor: pointer;
        }
        
        .user-avatar {
            width: 40px;
            height: 40px;
            background-color: #3498db;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        
        .profile-dropdown {
            position: absolute;
            right: 0;
            top: 50px;
            width: 250px;
            background-color: white;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            border-radius: 5px;
            z-index: 100;
            display: none;
        }
        
        .profile-dropdown.active {
            display: block;
        }
        
        .profile-header {
            padding: 15px;
            display: flex;
            align-items: center;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .avatar-lg {
            width: 50px;
            height: 50px;
            background-color: #3498db;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 15px;
            font-size: 18px;
        }
        
        .profile-info h4 {
            margin: 0;
            font-size: 16px;
        }
        
        .profile-info p {
            margin: 5px 0 0;
            font-size: 14px;
            color: #7f8c8d;
        }
        
        .profile-menu {
            padding: 10px 0;
        }
        
        .profile-menu a {
            display: block;
            padding: 10px 15px;
            color: #2c3e50;
            text-decoration: none;
            transition: all 0.3s;
        }
        
        .profile-menu a:hover {
            background-color: #f5f7fa;
        }
        
        .profile-menu i {
            margin-right: 10px;
        }
        
        .card {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            margin-bottom: 20px;
        }
        
        .card-header {
            padding: 15px 20px;
            border-bottom: 1px solid #f0f0f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .card-header h3 {
            margin: 0;
            font-size: 18px;
            color: #2c3e50;
        }
        
        .card-header h3 i {
            margin-right: 10px;
            color: #3498db;
        }
        
        .card-body {
            padding: 20px;
        }
        
        .welcome-message h4 {
            margin: 0 0 10px;
            color: #2c3e50;
        }
        
        .welcome-message p {
            margin: 0;
            color: #7f8c8d;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .stat-card {
            display: flex;
            align-items: center;
            padding: 15px;
            border-radius: 8px;
            color: white;
        }
        
        .stat-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            font-size: 20px;
        }
        
        .bg-primary {
            background-color: #3498db;
        }
        
        .bg-warning {
            background-color: #f39c12;
        }
        
        .stat-info h3 {
            margin: 0;
            font-size: 24px;
        }
        
        .stat-info p {
            margin: 5px 0 0;
            font-size: 14px;
            opacity: 0.9;
        }
        
        .quick-actions {
            margin-top: 30px;
        }
        
        .quick-actions h4 {
            margin: 0 0 15px;
            color: #2c3e50;
        }
        
        .quick-actions h4 i {
            margin-right: 10px;
            color: #f39c12;
        }
        
        .action-buttons {
            display: flex;
            gap: 10px;
        }
        
        .btn {
            padding: 10px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 500;
            display: inline-flex;
            align-items: center;
            transition: all 0.3s;
        }
        
        .btn i {
            margin-right: 8px;
        }
        
        .btn-primary {
            background-color: #3498db;
            color: white;
        }
        
        .btn-primary:hover {
            background-color: #2980b9;
        }
        
        .btn-success {
            background-color: #2ecc71;
            color: white;
        }
        
        .btn-success:hover {
            background-color: #27ae60;
        }
        
        .btn-warning {
            background-color: #f39c12;
            color: white;
        }
        
        .btn-warning:hover {
            background-color: #e67e22;
        }
        
        .btn-danger {
            background-color: #e74c3c;
            color: white;
        }
        
        .btn-danger:hover {
            background-color: #c0392b;
        }
        
        .btn-sm {
            padding: 5px 10px;
            font-size: 14px;
        }
        
        .form-row {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .form-col {
            flex: 1;
            min-width: 200px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #2c3e50;
        }
        
        .form-control {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-family: 'Poppins', sans-serif;
            transition: all 0.3s;
        }
        
        .form-control:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }
        
        .marks-type-tabs {
            display: flex;
            border-bottom: 1px solid #ddd;
            margin-bottom: 20px;
        }
        
        .marks-type-tab {
            padding: 10px 20px;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all 0.3s;
        }
        
        .marks-type-tab:hover {
            background-color: #f5f7fa;
        }
        
        .marks-type-tab.active {
            border-bottom-color: #3498db;
            color: #3498db;
            font-weight: 500;
        }
        
        .marks-type-tab i {
            margin-right: 8px;
        }
        
        .marks-type-content {
            display: none;
        }
        
        .marks-type-content.active {
            display: block;
        }
        
        .subject-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
        }
        
        .subject-input-group label {
            display: block;
            margin-bottom: 8px;
            font-size: 14px;
            color: #2c3e50;
        }
        
        .table-responsive {
            overflow-x: auto;
        }
        
        .table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .table th, .table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .table th {
            background-color: #f8f9fa;
            font-weight: 500;
            color: #2c3e50;
        }
        
        .table tr:hover {
            background-color: #f8f9fa;
        }
        
        .text-success {
            color: #2ecc71;
        }
        
        .text-warning {
            color: #f39c12;
        }
        
        .text-danger {
            color: #e74c3c;
        }
        
        .text-muted {
            color: #95a5a6;
        }
        
        .toast-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
        }
        
        .toast {
            padding: 15px 20px;
            margin-bottom: 10px;
            border-radius: 5px;
            color: white;
            display: flex;
            align-items: center;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
            animation: slideIn 0.3s ease-out;
        }
        
        .toast i {
            margin-right: 10px;
            font-size: 18px;
        }
        
        .toast-success {
            background-color: #2ecc71;
        }
        
        .toast-error {
            background-color: #e74c3c;
        }
        
        .toast.fade-out {
            animation: fadeOut 0.3s ease-out;
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        @keyframes fadeOut {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(100%);
                opacity: 0;
            }
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .semester-filter {
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
        }
        
        .semester-filter select {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-family: 'Poppins', sans-serif;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <h2><i class="fas fa-chalkboard-teacher"></i> Sessional</h2>
            </div>
            <nav class="sidebar-menu">
                <a href="#" class="menu-item active" data-section="dashboard">
                    <i class="fas fa-tachometer-alt"></i> Dashboard
                </a>
                <a href="#" class="menu-item" data-section="students">
                    <i class="fas fa-user-graduate"></i> Students
                </a>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Header -->
            <div class="header">
                <div class="header-title">
                    <h1 id="pageTitle">Sessional Marks Management</h1>
                </div>
                <div class="header-actions">
                    <div class="user-profile">
                        <div class="user-avatar" id="userAvatar">JD</div>
                        <div class="profile-dropdown" id="profileDropdown">
                            <div class="profile-header">
                                <div class="avatar-lg" id="profileAvatar">JD</div>
                                <div class="profile-info">
                                    <h4 id="profileName">John Doe</h4>
                                    <p id="profileEmail">john.doe@example.com</p>
                                </div>
                            </div>
                            <div class="profile-menu">
                                <a href="#" id="logoutBtn"><i class="fas fa-sign-out-alt"></i> Logout</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Dashboard Section -->
            <div class="section-content active" id="dashboardSection">
                <div class="card fade-in">
                    <div class="card-header">
                        <h3><i class="fas fa-chalkboard"></i> Teacher Dashboard</h3>
                    </div>
                    <div class="card-body">
                        <div class="welcome-message">
                            <h4>Welcome back, <span id="teacherGreeting">Teacher</span>!</h4>
                            <p>Here's your daily overview of Sessional marks.</p>
                        </div>

                        <!-- Quick Stats -->
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-icon bg-primary">
                                    <i class="fas fa-user-graduate"></i>
                                </div>
                                <div class="stat-info">
                                    <h3 id="totalStudents">0</h3>
                                    <p>Total Students</p>
                                </div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-icon bg-warning">
                                    <i class="fas fa-chart-line"></i>
                                </div>
                                <div class="stat-info">
                                    <h3 id="avgMarks">0%</h3>
                                    <p>Average Marks</p>
                                </div>
                            </div>
                        </div>

                        <!-- Quick Actions -->
                        <div class="quick-actions">
                            <h4><i class="fas fa-bolt"></i> Quick Actions</h4>
                            <div class="action-buttons">
                                <button class="btn btn-primary" onclick="navigateToSection('students')">
                                    <i class="fas fa-plus"></i> Add Student Marks
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="section-content" id="studentsSection">
                <!-- Student Management Card -->
                <div class="card fade-in">
                    <div class="card-header">
                        <h3><i class="fas fa-user-graduate"></i> Student Marks Management</h3>
                    </div>
                    <div class="card-body">
                        <form id="studentForm">
                            <div class="form-row">
                                <div class="form-col">
                                    <div class="form-group">
                                        <label class="form-label" for="studentRollNo">Roll Number</label>
                                        <input type="text" class="form-control" id="studentRollNo"
                                            placeholder="Enter roll number">
                                    </div>
                                </div>
                                <div class="form-col">
                                    <div class="form-group">
                                        <label class="form-label" for="studentName">Student Name</label>
                                        <input type="text" class="form-control" id="studentName"
                                            placeholder="Enter student name">
                                    </div>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-col">
                                    <div class="form-group">
                                        <label class="form-label" for="studentDepartment">Department</label>
                                        <select class="form-control" id="studentDepartment">
                                            <option value="">Select Department</option>
                                            <option value="Computer Science">Computer Science Engineering</option>
                                            <option value="Electrical Engineering">Electrical Engineering</option>
                                            <option value="Mechanical Engineering">Mechanical Engineering</option>
                                            <option value="Civil Engineering">Civil Engineering</option>
                                            <option value="Business Administration">Pharmacy Engineering</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <div class="form-col">
                                    <div class="form-group">
                                        <label class="form-label" for="studentSemester">Semester</label>
                                        <select class="form-control" id="studentSemester">
                                            <option value="">Select Semester</option>
                                            <option value="1">1st Semester</option>
                                            <option value="2">2nd Semester</option>
                                            <option value="3">3rd Semester</option>
                                            <option value="4">4th Semester</option>
                                            <option value="5">5th Semester</option>
                                            <option value="6">6th Semester</option>
                                        </select>
                                    </div>
                                </div>

                                <div class="form-col">
                                    <div class="form-group">
                                        <label class="form-label" for="studentSubject">Subject</label>
                                        <select class="form-control" id="studentSubject">
                                            <option value="">Select Subject</option>
                                            <!-- Subjects will be populated dynamically -->
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <!-- Marks Type Tabs -->
                            <div class="marks-type-tabs">
                                <div class="marks-type-tab active" data-tab="theoryMarks">
                                    <i class="fas fa-book"></i> Theory Marks
                                </div>
                                <div class="marks-type-tab" data-tab="practicalMarks">
                                    <i class="fas fa-laptop-code"></i> Practical Marks
                                </div>
                            </div>

                            <!-- Theory Marks Section -->
                            <div class="marks-type-content active" id="theoryMarks">
                                <div class="form-group">
                                    <label class="form-label">Theory Marks</label>
                                    <div class="subject-grid">
                                        <div class="subject-input-group">
                                            <label>1. House Test 1</label>
                                            <input type="number" class="form-control" id="houseTest1" placeholder="Marks"
                                                min="0" max="100">
                                        </div>
                                        <div class="subject-input-group">
                                            <label>2. House Test 2</label>
                                            <input type="number" class="form-control" id="houseTest2" placeholder="Marks"
                                                min="0" max="100">
                                        </div>
                                        <div class="subject-input-group">
                                            <label>3. House Test 3</label>
                                            <input type="number" class="form-control" id="houseTest3" placeholder="Marks"
                                                min="0" max="100">
                                        </div>
                                        <div class="subject-input-group">
                                            <label>4. Assignment</label>
                                            <input type="number" class="form-control" id="assignmentMarks" placeholder="Marks"
                                                min="0" max="100">
                                        </div>
                                        <div class="subject-input-group">
                                            <label>5. Seminar</label>
                                            <input type="number" class="form-control" id="seminarMarks" placeholder="Marks"
                                                min="0" max="100">
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Practical Marks Section -->
                            <div class="marks-type-content" id="practicalMarks">
                                <div class="form-group">
                                    <label class="form-label">Practical Marks</label>
                                    <div class="subject-grid">
                                        <div class="subject-input-group">
                                            <label>1. Practical File</label>
                                            <input type="number" class="form-control" id="practicalFile" placeholder="Marks"
                                                min="0" max="100">
                                        </div>
                                        <div class="subject-input-group">
                                            <label>2. Viva</label>
                                            <input type="number" class="form-control" id="vivaMarks" placeholder="Marks"
                                                min="0" max="100">
                                        </div>
                                        <div class="subject-input-group">
                                            <label>3. Performance</label>
                                            <input type="number" class="form-control" id="performanceMarks" placeholder="Marks"
                                                min="0" max="100">
                                        </div>
                                        <div class="subject-input-group">
                                            <label>4. Attendance</label>
                                            <input type="number" class="form-control" id="attendanceMarks" placeholder="Marks"
                                                min="0" max="100">
                                        </div>
                                        <div class="subject-input-group">
                                            <label>5. Total Practical Marks</label>
                                            <input type="number" class="form-control" id="totalPracticalMarks" placeholder="Marks"
                                                min="0" max="100" readonly>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="form-group">
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-plus"></i> Add Student
                                </button>
                                <button type="button" class="btn btn-success" id="saveAllData">
                                    <i class="fas fa-save"></i> Save All Data
                                </button>
                                <button type="button" class="btn btn-warning" id="clearForm">
                                    <i class="fas fa-eraser"></i> Clear Form
                                </button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Semester and Subject Filter -->
                <div class="card fade-in">
                    <div class="card-header">
                        <h3><i class="fas fa-filter"></i> Filter Records</h3>
                    </div>
                    <div class="card-body">
                        <div class="semester-filter">
                            <select id="filterSemester" class="form-control">
                                <option value="">All Semesters</option>
                                <option value="1">1st Semester</option>
                                <option value="2">2nd Semester</option>
                                <option value="3">3rd Semester</option>
                                <option value="4">4th Semester</option>
                            </select>
                            <select id="filterSubject" class="form-control">
                                <option value="">All Subjects</option>
                                <!-- Subjects will be populated dynamically -->
                            </select>
                            <button class="btn btn-primary" id="applyFilter">
                                <i class="fas fa-filter"></i> Apply Filter
                            </button>
                        </div>
                    </div>
                </div>

                <button type="button" class="btn btn-danger" id="downloadPdf">
                    <i class="fas fa-file-pdf"></i> Download PDF Report
                </button>

                <!-- Student Records Card -->
                <div class="card fade-in">
                    <div class="card-header">
                        <h3><i class="fas fa-table"></i> Student Records (Theory Marks)</h3>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>S/N</th>
                                        <th>Roll No</th>
                                        <th>Name</th>
                                        <th>Semester</th>
                                        <th>Subject</th>
                                        <th>House Test 1</th>
                                        <th>House Test 2</th>
                                        <th>House Test 3</th>
                                        <th>Assignment</th>
                                        <th>Seminar</th>
                                        <th>Total Marks</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="studentsTableBody">
                                    <!-- Student data will be inserted here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Practical Marks Records Card -->
                <div class="card fade-in">
                    <div class="card-header">
                        <h3><i class="fas fa-laptop-code"></i> Student Records (Practical Marks)</h3>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>S/N</th>
                                        <th>Roll No</th>
                                        <th>Name</th>
                                        <th>Semester</th>
                                        <th>Subject</th>
                                        <th>Practical File</th>
                                        <th>Viva</th>
                                        <th>Performance</th>
                                        <th>Attendance</th>
                                        <th>Total Marks</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="practicalTableBody">
                                    <!-- Practical marks data will be inserted here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Toast Notification Container -->
    <div class="toast-container" id="toastContainer"></div>

    <script src="https://cdn.sheetjs.com/xlsx-0.19.3/package/dist/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    <script>

        // Global variables
        let currentUser = null;
        let students = [];
        const semesterSubjects = {
            '1': ['Math', 'Physics', 'English', 'CFIT', 'Drawing', 'EVS'],
            '2': ['Math', 'Physics', 'English', 'BEEE', 'Chemistry'],
            '3': ['DE', 'Open Electrical', 'Database', 'C', 'Operating System', 'IWT'],
            '4': ['Java', 'CA', 'DSCU', 'GSED', 'CNS']
        };


        // DOM elements
        const studentForm = document.getElementById('studentForm');
        const saveAllDataBtn = document.getElementById('saveAllData');
        const clearFormBtn = document.getElementById('clearForm');
        const studentsTableBody = document.getElementById('studentsTableBody');
        const practicalTableBody = document.getElementById('practicalTableBody');
        const userAvatar = document.getElementById('userAvatar');
        const profileAvatar = document.getElementById('profileAvatar');
        const profileName = document.getElementById('profileName');
        const profileEmail = document.getElementById('profileEmail');
        const profileDropdown = document.getElementById('profileDropdown');
        const toastContainer = document.getElementById('toastContainer');
        const menuItems = document.querySelectorAll('.menu-item');
        const sectionContents = document.querySelectorAll('.section-content');
        const pageTitle = document.getElementById('pageTitle');
        const teacherGreeting = document.getElementById('teacherGreeting');
        const marksTypeTabs = document.querySelectorAll('.marks-type-tab');
        const marksTypeContents = document.querySelectorAll('.marks-type-content');
        const practicalFileInput = document.getElementById('practicalFile');
        const vivaMarksInput = document.getElementById('vivaMarks');
        const performanceMarksInput = document.getElementById('performanceMarks');
        const attendanceMarksInput = document.getElementById('attendanceMarks');
        const totalPracticalMarksInput = document.getElementById('totalPracticalMarks');
        const logoutBtn = document.getElementById('logoutBtn');
        const studentSemesterSelect = document.getElementById('studentSemester');
        const studentSubjectSelect = document.getElementById('studentSubject');
        const filterSemester = document.getElementById('filterSemester');
        const filterSubject = document.getElementById('filterSubject');
        const applyFilterBtn = document.getElementById('applyFilter');
        const downloadPdfBtn = document.getElementById('downloadPdf');

        function initApp() {
            loadData();
            setupEventListeners();
            updateDashboardStats();
            updateProfileSection();
            
            
            // Initialize semester-subject relationship
            studentSemesterSelect.addEventListener('change', updateSubjectOptions);
            filterSemester.addEventListener('change', updateFilterSubjectOptions);
        }

        // Load saved data from localStorage
        function loadData() {
            const savedStudents = localStorage.getItem('studentData');

            if (savedStudents) {
                students = JSON.parse(savedStudents);
                renderStudentsTable();
                renderPracticalTable();
            }
        }

        // Set up event listeners
        function setupEventListeners() {
            // Student form
            studentForm.addEventListener('submit', addStudent);

            // Buttons
            saveAllDataBtn.addEventListener('click', saveAllStudentData);
            clearFormBtn.addEventListener('click', clearStudentForm);
            logoutBtn.addEventListener('click', logout);
            applyFilterBtn.addEventListener('click', applyFilter);
            downloadPdfBtn.addEventListener('click', generatePdfReport);

            // Profile dropdown
            userAvatar.addEventListener('click', toggleProfileDropdown);

            // Navigation menu
            menuItems.forEach(item => {
                item.addEventListener('click', (e) => {
                    e.preventDefault();
                    navigateToSection(item.dataset.section);
                });
            });

            // Marks type tabs
            marksTypeTabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const tabId = tab.dataset.tab;
                    switchMarksTab(tabId);
                });
            });

            // Practical marks calculation
            [practicalFileInput, vivaMarksInput, performanceMarksInput, attendanceMarksInput].forEach(input => {
                input.addEventListener('input', calculatePracticalTotal);
            });
        }

        // Update subject options based on selected semester
        function updateSubjectOptions() {
            const semester = studentSemesterSelect.value;
            studentSubjectSelect.innerHTML = '<option value="">Select Subject</option>';
            
            if (semester && semesterSubjects[semester]) {
                semesterSubjects[semester].forEach(subject => {
                    const option = document.createElement('option');
                    option.value = subject;
                    option.textContent = subject;
                    studentSubjectSelect.appendChild(option);
                });
            }
        }

        // Update filter subject options based on selected semester
        function updateFilterSubjectOptions() {
            const semester = filterSemester.value;
            filterSubject.innerHTML = '<option value="">All Subjects</option>';
            
            if (semester && semesterSubjects[semester]) {
                semesterSubjects[semester].forEach(subject => {
                    const option = document.createElement('option');
                    option.value = subject;
                    option.textContent = subject;
                    filterSubject.appendChild(option);
                });
            }
        }

        // Apply filter to tables
        function applyFilter() {
            renderStudentsTable();
            renderPracticalTable();
        }

        // Switch between theory and practical marks tabs
        function switchMarksTab(tabId) {
            marksTypeTabs.forEach(tab => {
                tab.classList.toggle('active', tab.dataset.tab === tabId);
            });

            marksTypeContents.forEach(content => {
                content.classList.toggle('active', content.id === tabId);
            });
        }

        // Calculate practical total marks
        function calculatePracticalTotal() {
            const practicalFile = parseFloat(practicalFileInput.value) || 0;
            const viva = parseFloat(vivaMarksInput.value) || 0;
            const performance = parseFloat(performanceMarksInput.value) || 0;
            const attendance = parseFloat(attendanceMarksInput.value) || 0;
            
            const total = practicalFile + viva + performance + attendance;
            totalPracticalMarksInput.value = total > 0 ? total : '';
        }

        // Update profile section
        function updateProfileSection() {
            // Set default profile info
            const initials = "JD";
            userAvatar.textContent = initials;
            profileAvatar.textContent = initials;
            profileName.textContent = "John Doe";
            profileEmail.textContent = "john.doe@example.com";
            teacherGreeting.textContent = "Teacher";
        }

        // Add new student
        function addStudent(e) {
            e.preventDefault();
        
            // Validate required fields
            const rollNo = document.getElementById('studentRollNo').value;
            const name = document.getElementById('studentName').value;
            const semester = document.getElementById('studentSemester').value;
            const department = document.getElementById('studentDepartment').value;
            const subject = document.getElementById('studentSubject').value;
        
            if (!rollNo || !name || !semester || !department || !subject) {
                showToast('Please fill all required fields', 'error');
                return;
            }
        
            // Collect theory marks
            const houseTest1 = document.getElementById('houseTest1').value;
            const houseTest2 = document.getElementById('houseTest2').value;
            const houseTest3 = document.getElementById('houseTest3').value;
            const assignmentMarks = document.getElementById('assignmentMarks').value;
            const seminarMarks = document.getElementById('seminarMarks').value;
        
            // Collect practical marks
            const practicalFile = document.getElementById('practicalFile').value;
            const vivaMarks = document.getElementById('vivaMarks').value;
            const performanceMarks = document.getElementById('performanceMarks').value;
            const attendanceMarks = document.getElementById('attendanceMarks').value;
            const totalPracticalMarks = document.getElementById('totalPracticalMarks').value;
        
            if (!houseTest1 && !houseTest2 && !houseTest3 && !assignmentMarks && !seminarMarks && 
                !practicalFile && !vivaMarks && !performanceMarks && !attendanceMarks) {
                showToast('Please add at least one mark (theory or practical)', 'error');
                return;
            }
        
            const student = {
                rollNo,
                name,
                semester,
                department,
                subject,
                houseTest1,
                houseTest2,
                houseTest3,
                assignmentMarks,
                seminarMarks,
                practicalFile,
                vivaMarks,
                performanceMarks,
                attendanceMarks,
                totalPracticalMarks,
                addedDate: new Date().toISOString()
            };
        
            students.push(student);
            renderStudentsTable();
            renderPracticalTable();
            clearStudentForm();
        
            showToast('Student record added successfully!');
        }


        // Render students table (theory marks)
        function renderStudentsTable() {
            studentsTableBody.innerHTML = '';
        
            if (students.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td colspan="11" style="text-align: center; color: var(--gray);">
                        No student records found. Add some students to get started.
                    </td>
                `;
                studentsTableBody.appendChild(row);
                return;
            }
        
            students.forEach((student, index) => {
                // Skip if student has no theory marks
                if (!student.houseTest1 && !student.houseTest2 && !student.houseTest3 && 
                    !student.assignmentMarks && !student.seminarMarks) {
                    return;
                }
                
                const row = document.createElement('tr');
        
                // Helper function to create mark cell with color coding
                const createMarkCell = (mark) => {
                    const cell = document.createElement('td');
                    if (mark) {
                        const numMark = parseInt(mark);
                        cell.textContent = numMark;
                        cell.className = numMark >= 80 ? 'text-success' :
                            numMark >= 50 ? 'text-warning' : 'text-danger';
                    } else {
                        cell.textContent = '-';
                        cell.className = 'text-muted';
                    }
                    return cell;
                };
                
                // Calculate total theory marks
                const calculateTotalMarks = () => {
                    let total = 0;
                    if (student.houseTest1) total += parseInt(student.houseTest1);
                    if (student.houseTest2) total += parseInt(student.houseTest2);
                    if (student.houseTest3) total += parseInt(student.houseTest3);
                    if (student.assignmentMarks) total += parseInt(student.assignmentMarks);
                    if (student.seminarMarks) total += parseInt(student.seminarMarks);
                    return total;
                };
                
                const totalMarks = calculateTotalMarks();
                
                // Create cells for basic info
                const snCell = document.createElement('td');
                snCell.textContent = index + 1;
                row.appendChild(snCell);
                
                const rollNoCell = document.createElement('td');
                rollNoCell.textContent = student.rollNo;
                row.appendChild(rollNoCell);
        
                const nameCell = document.createElement('td');
                nameCell.textContent = student.name;
                row.appendChild(nameCell);
                
                // Add subject cell
                const subjectCell = document.createElement('td');
                subjectCell.textContent = student.subject;
                row.appendChild(subjectCell);

                // Add theory mark cells
                row.appendChild(createMarkCell(student.houseTest1));
                row.appendChild(createMarkCell(student.houseTest2));
                row.appendChild(createMarkCell(student.houseTest3));
                row.appendChild(createMarkCell(student.assignmentMarks));
                row.appendChild(createMarkCell(student.seminarMarks));
                
                // Add total marks cell
                const totalCell = document.createElement('td');
                totalCell.textContent = totalMarks;
                // Apply color coding based on percentage (assuming max possible is 500)
                const percentage = (totalMarks / 500) * 100;
                totalCell.className = percentage >= 80 ? 'text-success' :
                    percentage >= 50 ? 'text-warning' : 'text-danger';
                row.appendChild(totalCell);
        
                // Actions cell
                const actionsCell = document.createElement('td');
                actionsCell.innerHTML = `
                    <button class="btn btn-primary btn-sm" onclick="editStudent(${index})">
                        <i class="fas fa-edit"></i> Edit
                    </button>
                    <button class="btn btn-danger btn-sm" onclick="deleteStudent(${index})">
                        <i class="fas fa-trash"></i> Delete
                    </button>
                `;
                row.appendChild(actionsCell);
        
                studentsTableBody.appendChild(row);
            });
        }

        // Render practical marks table
        function renderPracticalTable() {
            practicalTableBody.innerHTML = '';
        
            if (students.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td colspan="10" style="text-align: center; color: var(--gray);">
                        No practical marks records found. Add some students to get started.
                    </td>
                `;
                practicalTableBody.appendChild(row);
                return;
            }
        
            students.forEach((student, index) => {
                // Skip if student has no practical marks
                if (!student.practicalFile && !student.vivaMarks && !student.performanceMarks && 
                    !student.attendanceMarks) {
                    return;
                }
                
                const row = document.createElement('tr');
        
                // Helper function to create mark cell with color coding
                const createMarkCell = (mark) => {
                    const cell = document.createElement('td');
                    if (mark) {
                        const numMark = parseInt(mark);
                        cell.textContent = numMark;
                        cell.className = numMark >= 80 ? 'text-success' :
                            numMark >= 50 ? 'text-warning' : 'text-danger';
                    } else {
                        cell.textContent = '-';
                        cell.className = 'text-muted';
                    }
                    return cell;
                };
                
                // Calculate total practical marks
                const calculateTotalPracticalMarks = () => {
                    let total = 0;
                    if (student.practicalFile) total += parseInt(student.practicalFile);
                    if (student.vivaMarks) total += parseInt(student.vivaMarks);
                    if (student.performanceMarks) total += parseInt(student.performanceMarks);
                    if (student.attendanceMarks) total += parseInt(student.attendanceMarks);
                    return total;
                };
                
                const totalPracticalMarks = calculateTotalPracticalMarks();
                
                // Create cells for basic info
                const snCell = document.createElement('td');
                snCell.textContent = index + 1;
                row.appendChild(snCell);
                
                const rollNoCell = document.createElement('td');
                rollNoCell.textContent = student.rollNo;
                row.appendChild(rollNoCell);
        
                const nameCell = document.createElement('td');
                nameCell.textContent = student.name;
                row.appendChild(nameCell);
                
                // Add subject cell
                const subjectCell = document.createElement('td');
                subjectCell.textContent = student.subject;
                row.appendChild(subjectCell);

                // Add practical mark cells
                row.appendChild(createMarkCell(student.practicalFile));
                row.appendChild(createMarkCell(student.vivaMarks));
                row.appendChild(createMarkCell(student.performanceMarks));
                row.appendChild(createMarkCell(student.attendanceMarks));
                
                // Add total practical marks cell
                const totalCell = document.createElement('td');
                totalCell.textContent = totalPracticalMarks;
                // Apply color coding based on percentage (assuming max possible is 400)
                const percentage = (totalPracticalMarks / 400) * 100;
                totalCell.className = percentage >= 80 ? 'text-success' :
                    percentage >= 50 ? 'text-warning' : 'text-danger';
                row.appendChild(totalCell);
        
                // Actions cell
                const actionsCell = document.createElement('td');
                actionsCell.innerHTML = `
                    <button class="btn btn-primary btn-sm" onclick="editStudent(${index})">
                        <i class="fas fa-edit"></i> Edit
                    </button>
                    <button class="btn btn-danger btn-sm" onclick="deleteStudent(${index})">
                        <i class="fas fa-trash"></i> Delete
                    </button>
                `;
                row.appendChild(actionsCell);
        
                practicalTableBody.appendChild(row);
            });
        }

        // Edit student
        function editStudent(index) {
            const student = students[index];
        
            // Fill the form with student data
            document.getElementById('studentRollNo').value = student.rollNo;
            document.getElementById('studentName').value = student.name;
            document.getElementById('studentSemester').value = student.semester || '';
            document.getElementById('studentDepartment').value = student.department || '';
            document.getElementById('studentSubject').value = student.subject || '';
        
            // Fill theory marks
            document.getElementById('houseTest1').value = student.houseTest1 || '';
            document.getElementById('houseTest2').value = student.houseTest2 || '';
            document.getElementById('houseTest3').value = student.houseTest3 || '';
            document.getElementById('assignmentMarks').value = student.assignmentMarks || '';
            document.getElementById('seminarMarks').value = student.seminarMarks || '';
        
            // Fill practical marks
            document.getElementById('practicalFile').value = student.practicalFile || '';
            document.getElementById('vivaMarks').value = student.vivaMarks || '';
            document.getElementById('performanceMarks').value = student.performanceMarks || '';
            document.getElementById('attendanceMarks').value = student.attendanceMarks || '';
            document.getElementById('totalPracticalMarks').value = student.totalPracticalMarks || '';
        
            // Remove the student from the array (will be re-added when saved)
            students.splice(index, 1);
        
            showToast('Student record loaded for editing', 'success');
        }

        // Delete student
        function deleteStudent(index) {
            if (confirm('Are you sure you want to delete this student record?')) {
                students.splice(index, 1);
                renderStudentsTable();
                renderPracticalTable();
                showToast('Student record deleted successfully!');
            }
        }

        // Clear student form
        function clearStudentForm() {
            document.getElementById('studentRollNo').value = '';
            document.getElementById('studentName').value = '';
            document.getElementById('studentSemester').value = '';
            document.getElementById('studentDepartment').value = '';
            document.getElementById('studentSubject').value = '';
        
            // Clear theory marks fields
            document.getElementById('houseTest1').value = '';
            document.getElementById('houseTest2').value = '';
            document.getElementById('houseTest3').value = '';
            document.getElementById('assignmentMarks').value = '';
            document.getElementById('seminarMarks').value = '';
        
            // Clear practical marks fields
            document.getElementById('practicalFile').value = '';
            document.getElementById('vivaMarks').value = '';
            document.getElementById('performanceMarks').value = '';
            document.getElementById('attendanceMarks').value = '';
            document.getElementById('totalPracticalMarks').value = '';
        }

        // Save all student data
        function saveAllStudentData() {
            localStorage.setItem('studentData', JSON.stringify(students));
            showToast('All student data has been saved successfully!');
        }

        // Toggle profile dropdown
        function toggleProfileDropdown(e) {
            e.stopPropagation();
            profileDropdown.classList.toggle('active');

            if (profileDropdown.classList.contains('active')) {
                document.addEventListener('click', closeProfileDropdown);
            } else {
                document.removeEventListener('click', closeProfileDropdown);
            }
        }

        // Close profile dropdown
        function closeProfileDropdown() {
            profileDropdown.classList.remove('active');
            document.removeEventListener('click', closeProfileDropdown);
        }

        // Show toast notification
        function showToast(message, type = 'success') {
            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;
            toast.innerHTML = `
                <i class="fas ${type === 'success' ? 'fa-check-circle' : 'fa-exclamation-circle'}"></i>
                ${message}
            `;
            toastContainer.appendChild(toast);

            // Remove toast after 5 seconds
            setTimeout(() => {
                toast.classList.add('fade-out');
                setTimeout(() => toast.remove(), 300);
            }, 5000);
        }

        // Navigate to section
        function navigateToSection(section) {
            // Hide all sections
            document.querySelectorAll('.section-content').forEach(content => {
                content.classList.remove('active');
            });

            // Show selected section
            document.getElementById(`${section}Section`).classList.add('active');

            // Update active menu item
            document.querySelectorAll('.menu-item').forEach(item => {
                item.classList.toggle('active', item.dataset.section === section);
            });

            // Update page title
            const titles = {
                dashboard: 'Dashboard',
                students: 'Student Management'
            };
            document.getElementById('pageTitle').textContent = titles[section];
        }

        // Logout
        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                showToast('You have been logged out successfully', 'success');
                // Reset profile info
                updateProfileSection();
            }
        }

        // Update dashboard stats
        function updateDashboardStats() {
            // Total students
            document.getElementById('totalStudents').textContent = students.length;
        
            // Average marks
            if (students.length > 0) {
                let totalMarks = 0;
                let count = 0;
        
                students.forEach(student => {
                    if (student.houseTest1) {
                        totalMarks += parseInt(student.houseTest1);
                        count++;
                    }
                    if (student.houseTest2) {
                        totalMarks += parseInt(student.houseTest2);
                        count++;
                    }
                    if (student.houseTest3) {
                        totalMarks += parseInt(student.houseTest3);
                        count++;
                    }
                    if (student.assignmentMarks) {
                        totalMarks += parseInt(student.assignmentMarks);
                        count++;
                    }
                    if (student.seminarMarks) {
                        totalMarks += parseInt(student.seminarMarks);
                        count++;
                    }
                });
        
                const avgMarks = count > 0 ? (totalMarks / count) : 0;
                document.getElementById('avgMarks').textContent = avgMarks.toFixed(1) + '%';
            }
        }


        
// Generate PDF report
function generatePdfReport() {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();
    
    // Add title
    doc.setFontSize(18);
    doc.setTextColor(40);
    doc.text('Sessional Marks Report', 105, 15, { align: 'center' });
    
    // Add date
    doc.setFontSize(10);
    doc.text(`Generated on: ${new Date().toLocaleDateString()}`, 105, 22, { align: 'center' });
    
    // Prepare data for the table
    const reportData = students.map((student, index) => {
        // Calculate total theory marks
        const theoryTotal = [
            student.houseTest1,
            student.houseTest2,
            student.houseTest3,
            student.assignmentMarks,
            student.seminarMarks
        ].reduce((sum, mark) => sum + (parseInt(mark) || 0), 0);
        
        // Calculate total practical marks
        const practicalTotal = [
            student.practicalFile,
            student.vivaMarks,
            student.performanceMarks,
            student.attendanceMarks
        ].reduce((sum, mark) => sum + (parseInt(mark) || 0), 0);
        
        return [
            index + 1,
            student.rollNo,
            student.name,
            theoryTotal,
            practicalTotal
        ];
    });
    
    // Add table
    doc.autoTable({
        head: [['S.No', 'Roll No', 'Name', 'Total Theory', 'Total Practical']],
        body: reportData,
        startY: 30,
        styles: {
            fontSize: 10,
            cellPadding: 2,
            valign: 'middle'
        },
        headStyles: {
            fillColor: [41, 128, 185],
            textColor: 255,
            fontStyle: 'bold'
        },
        alternateRowStyles: {
            fillColor: [245, 245, 245]
        },
        columnStyles: {
            0: { cellWidth: 15 }, // S.No
            1: { cellWidth: 25 }, // Roll No
            2: { cellWidth: 50 }, // Name
            3: { cellWidth: 30 }, // Theory
            4: { cellWidth: 30 }  // Practical
        },
        didDrawPage: function (data) {
            // Footer
            doc.setFontSize(10);
            doc.setTextColor(150);
            doc.text('Sessional Marks Management System', data.settings.margin.left, doc.internal.pageSize.height - 10);
        }
    });
    
    // Save the PDF
    doc.save(`Sessional_Marks_Report_${new Date().toISOString().slice(0,10)}.pdf`);
}

// Add event listener for the PDF button in setupEventListeners()
document.getElementById('downloadPdf').addEventListener('click', generatePdfReport);


// Inside your existing setupEventListeners() function, add:
document.getElementById('downloadPdf').addEventListener('click', generatePdfReport);

// Add this new function anywhere in your script:
function generatePdfReport() {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();
    
    // Add title
    doc.setFontSize(18);
    doc.setTextColor(40);
    doc.text('Sessional Marks Report', 105, 15, { align: 'center' });
    
    // Add date
    doc.setFontSize(10);
    doc.text(`Generated on: ${new Date().toLocaleDateString()}`, 105, 22, { align: 'center' });
    
    // Prepare data for the table
    const reportData = students.map((student, index) => {
        // Calculate total theory marks
        const theoryTotal = [
            student.houseTest1,
            student.houseTest2,
            student.houseTest3,
            student.assignmentMarks,
            student.seminarMarks
        ].reduce((sum, mark) => sum + (parseInt(mark) || 0), 0);
        
        // Calculate total practical marks
        const practicalTotal = [
            student.practicalFile,
            student.vivaMarks,
            student.performanceMarks,
            student.attendanceMarks
        ].reduce((sum, mark) => sum + (parseInt(mark) || 0), 0);
        
        return [
            index + 1,
            student.rollNo,
            student.name,
            theoryTotal,
            practicalTotal
        ];
    });
    
    // Add table
    doc.autoTable({
        head: [['S.No', 'Roll No', 'Name', 'Total Theory', 'Total Practical']],
        body: reportData,
        startY: 30,
        styles: {
            fontSize: 10,
            cellPadding: 2,
            valign: 'middle'
        },
        headStyles: {
            fillColor: [41, 128, 185],
            textColor: 255,
            fontStyle: 'bold'
        },
        alternateRowStyles: {
            fillColor: [245, 245, 245]
        },
        columnStyles: {
            0: { cellWidth: 15 }, // S.No
            1: { cellWidth: 25 }, // Roll No
            2: { cellWidth: 50 }, // Name
            3: { cellWidth: 30 }, // Theory
            4: { cellWidth: 30 }  // Practical
        },
        didDrawPage: function (data) {
            // Footer
            doc.setFontSize(10);
            doc.setTextColor(150);
            doc.text('Sessional Marks Management System', data.settings.margin.left, doc.internal.pageSize.height - 10);
        }
    });
    
    // Save the PDF
    doc.save(`Sessional_Marks_Report_${new Date().toISOString().slice(0,10)}.pdf`);
}



        // Initialize the app when DOM is loaded
        document.addEventListener('DOMContentLoaded', initApp);

        // Make functions available globally for inline event handlers
        window.editStudent = editStudent;
        window.deleteStudent = deleteStudent;
        window.navigateToSection = navigateToSection;
  

    </script>

</body>

</html>
